<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiches de Maths</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: 'Arial', sans-serif; background: #fdf6e3; color: #333; margin: 0; padding: 0; }
    header { background: #268bd2; color: white; padding: 1em; text-align: center; }
    button { margin: 0.5em; padding: 0.5em 1em; border-radius: 5px; border: none; cursor: pointer; }
    button:hover { opacity: 0.9; }
    .enseignant { display: none; margin: 1em; }
    .fiche { background: #eee8d5; margin: 1em; padding: 1em; border-radius: 8px; }
    .container { display: flex; flex-wrap: wrap; justify-content: center; }
    textarea { width: 100%; height: 100px; font-size: 1em; }
  </style>
</head>
<body>

<header>
  <h1>Fiches de Maths</h1>
  <button id="modeEleveBtn">Mode élève</button>
  <button id="modeEnseignantBtn">Mode enseignant</button>
</header>

<div class="enseignant" id="enseignantPanel">
  <h2>Ajouter une fiche</h2>
  <input type="text" id="titreFiche" placeholder="Titre de la fiche"><br><br>
  <textarea id="contenuFiche" placeholder="Contenu (MathJax autorisé)"></textarea><br>
  <button id="ajouterFicheBtn">Ajouter la fiche</button>
</div>

<div class="container" id="fichesContainer">
  <!-- Les fiches apparaîtront ici -->
</div>

<script>
  // === CONFIGURATION SUPABASE ===
  const supabaseUrl = 'https://qzetwcnumydxgyjtumdz.supabase.co';
  const supabaseKey = 'sb_publishable_BVXGIlfdPAiFZ_h-1pVNDQ_VcCTPlBF';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  // === ELEMENTS ===
  const modeEleveBtn = document.getElementById('modeEleveBtn');
  const modeEnseignantBtn = document.getElementById('modeEnseignantBtn');
  const enseignantPanel = document.getElementById('enseignantPanel');
  const ajouterFicheBtn = document.getElementById('ajouterFicheBtn');
  const fichesContainer = document.getElementById('fichesContainer');

  // === GESTION MODE ===
  modeEleveBtn.onclick = () => {
    enseignantPanel.style.display = 'none';
  }

  modeEnseignantBtn.onclick = async () => {
    const mdp = prompt("Mot de passe enseignant ?");
    if(mdp === "TonMotDePasse") { // CHANGE LE MOT DE PASSE ICI
      enseignantPanel.style.display = 'block';
    } else {
      alert("Mot de passe incorrect !");
    }
  }

  // === AJOUT DE FICHE ===
  ajouterFicheBtn.onclick = async () => {
    const titre = document.getElementById('titreFiche').value;
    const contenu = document.getElementById('contenuFiche').value;
    if(!titre || !contenu) return alert("Remplis tous les champs !");
    
    const { data, error } = await supabase
      .from('fiches')
      .insert([{ titre, contenu }]);
    
    if(error) { alert("Erreur : " + error.message); return; }
    
    document.getElementById('titreFiche').value = '';
    document.getElementById('contenuFiche').value = '';
    chargerFiches();
  }

  // === CHARGEMENT DES FICHES ===
  async function chargerFiches() {
    const { data, error } = await supabase
      .from('fiches')
      .select('*')
      .order('id', { ascending: true });

    if(error) { console.log(error); return; }

    fichesContainer.innerHTML = '';
    data.forEach(fiche => {
      const div = document.createElement('div');
      div.className = 'fiche';
      div.innerHTML = `<h3>${fiche.titre}</h3><p>${fiche.contenu}</p>`;
      fichesContainer.appendChild(div);
    });

    MathJax.typeset(); // Pour afficher les maths
  }

  // Au démarrage
  chargerFiches();
</script>

</body>
</html>
