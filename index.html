<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fiches Math</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    .hidden { display: none; }
    .card { border: 1px solid #ccc; padding: 10px; margin: 5px 0; }
    button { margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Fiches Math</h1>

  <div id="auth-section">
    <h2>Mode enseignant</h2>
    <input type="email" id="email" placeholder="Email enseignant">
    <input type="password" id="password" placeholder="Mot de passe">
    <button id="login-btn">Se connecter</button>
    <p id="login-msg"></p>
  </div>

  <div id="teacher-section" class="hidden">
    <h2>Ajouter une fiche</h2>
    <input type="text" id="title" placeholder="Titre de la fiche">
    <textarea id="content" placeholder="Contenu en LaTeX"></textarea>
    <button id="add-btn">Ajouter</button>
    <button id="logout-btn">Se déconnecter</button>
  </div>

  <div id="cards-section">
    <h2>Fiches disponibles</h2>
    <div id="cards-list"></div>
  </div>

  <script>
    // ⚠️ Remplace ces valeurs par les tiennes (variables Netlify)
    const SUPABASE_URL = 'VOTRE_SUPABASE_URL';
    const SUPABASE_ANON_KEY = 'VOTRE_SUPABASE_ANON_KEY';

    const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const addBtn = document.getElementById('add-btn');

    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginMsg = document.getElementById('login-msg');

    const teacherSection = document.getElementById('teacher-section');
    const cardsList = document.getElementById('cards-list');

    // Affiche les fiches
    async function fetchCards() {
      const { data: cards, error } = await supabase.from('cards').select('*');
      if (error) {
        console.error(error);
        return;
      }
      cardsList.innerHTML = '';
      cards.forEach(card => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<strong>${card.title}</strong><div>${card.content}</div>`;
        MathJax.typesetPromise([div]);
        cardsList.appendChild(div);
      });
    }

    fetchCards();

    // Connexion enseignant
    loginBtn.addEventListener('click', async () => {
      const { data, error } = await supabase.auth.signInWithPassword({
        email: emailInput.value,
        password: passwordInput.value
      });
      if (error) {
        loginMsg.textContent = 'Erreur : ' + error.message;
        return;
      }
      loginMsg.textContent = 'Connecté !';
      teacherSection.classList.remove('hidden');
    });

    // Déconnexion
    logoutBtn.addEventListener('click', async () => {
      await supabase.auth.signOut();
      teacherSection.classList.add('hidden');
      loginMsg.textContent = 'Déconnecté';
    });

    // Ajouter une fiche
    addBtn.addEventListener('click', async () => {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const { error } = await supabase.from('cards').insert([{ title, content }]);
      if (error) {
        alert('Erreur : ' + error.message);
      } else {
        fetchCards();
        document.getElementById('title').value = '';
        document.getElementById('content').value = '';
      }
    });
  </script>
</body>
</html>
